[server]
address = "127.0.0.1"
port = 8080

[[services]]
name = "tool.execute"
route = "/api/tools/execute"
kind = "tool_execute"
description = "Tool execution entrypoint"
[services.auth]
api_key = "local-dev-key"
[services.schema]
required_headers = ["x-api-key"]
required_fields = ["tenant", "tool_id"]

[[services]]
name = "collab.execute"
route = "/api/collab/execute"
kind = "collab_execute"
description = "Collaboration execution entrypoint"
[services.schema]
required_fields = ["collab_id"]

[[services]]
name = "collab.resolve"
route = "/api/collab/resolve"
kind = "collab_resolve"
description = "Collaboration resolution entrypoint"
[services.schema]
required_fields = ["collab_id"]

[[services]]
name = "llm.complete"
route = "/api/llm/complete"
kind = "llm_complete"
description = "Language model completion endpoint"
[services.schema]
required_headers = ["x-api-key"]
required_fields = ["prompt"]

[[services]]
name = "llm.stream"
route = "/api/llm/stream"
kind = "llm_stream"
description = "Language model streaming endpoint"
[services.schema]
required_headers = ["x-api-key"]
required_fields = ["prompt"]

[[services]]
name = "llm.embed"
route = "/api/llm/embed"
kind = "llm_embed"
description = "Embedding endpoint"
[services.schema]
required_headers = ["x-api-key"]
required_fields = ["text"]

[[services]]
name = "graph.recall"
route = "/api/graph/recall"
kind = "graph_recall"
description = "Graph adjacency recall"
[services.schema]
required_fields = ["node_id"]
[services.auth]
scopes = ["graph:read"]
allow_anonymous = false

[[services]]
name = "observe.emit"
route = "/api/observe/emit"
kind = "observe_emit"
description = "Observation event ingest"
[services.schema]
required_fields = ["topic", "event"]
[services.auth]
scopes = ["observe:emit"]
allow_anonymous = false

[[services]]
name = "repo.append"
route = "/api/repo/append"
kind = "repo_append"
description = "Append record to repo"
[services.schema]
required_fields = ["repo", "data"]
[services.auth]
scopes = ["repo:write"]
allow_anonymous = false

[[services]]
name = "config.tools"
route = "/api/config/tools"
kind = "config_tools"
description = "Tool manifest registry API"
[services.auth]
scopes = ["config:manage"]
allow_anonymous = false

[[services]]
name = "tool.list"
route = "/api/tools/list"
kind = "tool_list"
description = "List available tools"
[services.auth]
api_key = "local-dev-key"

[[services]]
name = "tool.preflight"
route = "/api/tools/preflight"
kind = "tool_preflight"
description = "Tool invocation preflight"
[services.auth]
api_key = "local-dev-key"
[services.schema]
required_headers = ["x-api-key"]
required_fields = ["tenant", "tool_id"]

[tools]

[tools.registry]
kind = "in_memory"

[tools.idempotency]
enabled = true
ttl_ms = 300000
failure_ttl_ms = 60000
[tools.idempotency.store]
kind = "memory"

[tools.evidence]
enabled = true
[tools.evidence.store]
kind = "memory"

[[tools.manifests]]
tenant = "tenant-demo"
id = "demo.echo"
version = "1.0.0"
display_name = "Echo Tool"
description = "Echoes the provided input payload"
tags = ["demo"]
input_schema = {}
output_schema = {}
scopes = []
[[tools.manifests.capabilities]]
domain = "tmp"
action = "use"
resource = "/tmp"
attrs = {}
side_effect = "None"
safety_class = "Low"
[tools.manifests.consent]
required = false
[tools.manifests.limits]
timeout_ms = 1000
max_bytes_in = 4096
max_bytes_out = 4096
max_files = 0
max_depth = 0
max_concurrency = 1

idempotency = "None"
concurrency = "Parallel"

[llm]
default_complete_model = "local:echo"
default_stream_model = "local:echo"
default_embed_model = "local:emb"

[[llm.providers]]
kind = "local"

[auth]

[[auth.tokens]]
name = "local-cli"
token_env = "GATEWAY_TOKEN_LOCAL"
tenant = "tenant-demo"
scopes = ["graph:read", "repo:write", "observe:emit"]
[auth.tokens.subject]
kind = "Service"
subject_id = "cli.local"

[[auth.hmac_keys]]
key_id = "local-hmac"
secret_env = "GATEWAY_HMAC_LOCAL"
tenant = "tenant-demo"
scopes = ["repo:write"]
[auth.hmac_keys.subject]
kind = "Service"
subject_id = "automation.local"

[storage.repo]
kind = "memory"

[storage.observe]
kind = "memory"

[storage.graph]
kind = "memory"

[policy]

[[policy.rules]]
id = "allow-local"
description = "Allow local development scopes"
resources = ["route:/api/*"]
actions = ["Read", "Write", "Invoke", "List"]
effect = "Allow"
